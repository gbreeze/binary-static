{"version":3,"sources":["../../../src/javascript/landing_pages/signup_frame.js"],"names":["error_class","window","onload","dataLayer","push","event","el_email","document","getElementById","el_signup","el_success","ws","wsConnect","sendVerifyEmail","wsSend","verify_email","value","type","validation_set","frm_verify_email","addEventListener","e","preventDefault","validateEmail","forEach","setValidationStyle","readyState","onopen","onmessage","msg","response","JSON","parse","data","error","classList","add","remove","gclid","getParamValue","referrer","localStorage","setItem","email","test","element","has_error"],"mappings":"AAAA,GAAMA,aAAc,aAApB,CAEAC,OAAOC,MAAP,CAAgB,UAAY,CACxBC,UAAUC,IAAV,CAAe,CAAEC,MAAO,WAAT,CAAf,EAEA,GAAMC,UAAaC,SAASC,cAAT,CAAwB,OAAxB,CAAnB,CACA,GAAMC,WAAaF,SAASC,cAAT,CAAwB,QAAxB,CAAnB,CACA,GAAME,YAAaH,SAASC,cAAT,CAAwB,SAAxB,CAAnB,CAEA,GAAMG,IAAKC,WAAX,CAEA,QAASC,gBAAT,EAA2B,CACvBC,OAAOH,EAAP,CAAW,CACPI,aAAcT,SAASU,KADhB,CAEPC,KAAc,iBAFP,CAAX,CAIH,CAED,GAAIC,gBAAiB,KAArB,CAA4B;AAC5B,GAAMC,kBAAmBZ,SAASC,cAAT,CAAwB,kBAAxB,CAAzB,CACA,GAAIW,gBAAJ,CAAsB,CAClBA,iBAAiBC,gBAAjB,CAAkC,QAAlC,CAA4C,SAACC,CAAD,CAAO,CAC/CA,EAAEC,cAAF,GAEA,GAAI,CAACC,cAAcjB,SAASU,KAAvB,CAAL,CAAoC,CAChC,GAAI,CAACE,cAAL,CAAqB,CACjB,CAAC,OAAD,CAAU,QAAV,EAAoBM,OAApB,CAA4B,SAACnB,KAAD,CAAW,CACnCC,SAASc,gBAAT,CAA0Bf,KAA1B,CAAiC,UAAM,CACnCoB,mBAAmBnB,QAAnB,CAA6B,CAACiB,cAAcjB,SAASU,KAAvB,CAA9B,CACH,CAFD,CAGH,CAJD,EAKAS,mBAAmBnB,QAAnB,CAA6B,CAACiB,cAAcjB,SAASU,KAAvB,CAA9B,EACAE,eAAiB,IACpB,CACD,MAAO,MACV,CAED,GAAIP,GAAGe,UAAH,GAAkB,CAAtB,CAAyB,CACrBb,iBACH,CAFD,IAEO,CACHF,GAAGgB,MAAH,CAAYd,eACf,CACD,MAAO,KACV,CAtBD,CAuBH,CAEDF,GAAGiB,SAAH,CAAe,SAASC,GAAT,CAAc,CACzB,GAAMC,UAAWC,KAAKC,KAAL,CAAWH,IAAII,IAAf,CAAjB,CACAR,mBAAmBnB,QAAnB,CAA6BwB,SAASI,KAAtC,EACA,GAAI,CAACJ,SAASI,KAAd,CAAqB,CACjBzB,UAAU0B,SAAV,CAAoBC,GAApB,CAAwB,WAAxB,EACA1B,WAAWyB,SAAX,CAAqBE,MAArB,CAA4B,WAA5B,CACH,CACJ,CAPD,CASA;AACA,GAAMC,OAAQC,cAAchC,SAASiC,QAAvB,CAAiC,OAAjC,CAAd,CACA,GAAIF,KAAJ,CAAW,CACPG,aAAaC,OAAb,CAAqB,OAArB,CAA8BJ,KAA9B,CACH,CACJ,CA1DD,CA4DA,QAASf,cAAT,CAAuBoB,KAAvB,CAA8B,CAC1B,MAAO,qDAAoDC,IAApD,CAAyDD,KAAzD,CACV,CAED,QAASlB,mBAAT,CAA4BoB,OAA5B,CAAqCC,SAArC,CAAgD,CAC5CD,QAAQV,SAAR,CAAkBW,UAAY,KAAZ,CAAoB,QAAtC,EAAgD9C,WAAhD,CACH","file":"signup_frame.js","sourcesContent":["const error_class = 'error-field';\r\n\r\nwindow.onload = function () {\r\n    dataLayer.push({ event: 'page_load' });\r\n\r\n    const el_email   = document.getElementById('email');\r\n    const el_signup  = document.getElementById('signup');\r\n    const el_success = document.getElementById('success');\r\n\r\n    const ws = wsConnect();\r\n\r\n    function sendVerifyEmail() {\r\n        wsSend(ws, {\r\n            verify_email: el_email.value,\r\n            type        : 'account_opening',\r\n        });\r\n    }\r\n\r\n    let validation_set = false; // To prevent validating before submit\r\n    const frm_verify_email = document.getElementById('frm_verify_email');\r\n    if (frm_verify_email) {\r\n        frm_verify_email.addEventListener('submit', (e) => {\r\n            e.preventDefault();\r\n\r\n            if (!validateEmail(el_email.value)) {\r\n                if (!validation_set) {\r\n                    ['input', 'change'].forEach((event) => {\r\n                        el_email.addEventListener(event, () => {\r\n                            setValidationStyle(el_email, !validateEmail(el_email.value));\r\n                        });\r\n                    });\r\n                    setValidationStyle(el_email, !validateEmail(el_email.value));\r\n                    validation_set = true;\r\n                }\r\n                return false;\r\n            }\r\n\r\n            if (ws.readyState === 1) {\r\n                sendVerifyEmail();\r\n            } else {\r\n                ws.onopen = sendVerifyEmail;\r\n            }\r\n            return true;\r\n        });\r\n    }\r\n\r\n    ws.onmessage = function(msg) {\r\n        const response = JSON.parse(msg.data);\r\n        setValidationStyle(el_email, response.error);\r\n        if (!response.error) {\r\n            el_signup.classList.add('invisible');\r\n            el_success.classList.remove('invisible');\r\n        }\r\n    };\r\n\r\n    // Store gclid\r\n    const gclid = getParamValue(document.referrer, 'gclid');\r\n    if (gclid) {\r\n        localStorage.setItem('gclid', gclid);\r\n    }\r\n};\r\n\r\nfunction validateEmail(email) {\r\n    return /^[a-zA-Z0-9_.+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,63}$/.test(email);\r\n}\r\n\r\nfunction setValidationStyle(element, has_error) {\r\n    element.classList[has_error ? 'add' : 'remove'](error_class);\r\n}\r\n"]}